<?php

class Accounts {
	public $db;
	public $tprefix;
	public function __construct() {
		$this->db = new DDB();
		$this->tprefix = TPREFIX;
	}
	public function SessionLive() {
		if(isset($_SESSION['user']['id'])) {
			return true;
		}
		else {
			return false;
		}
	}
	public function Login($arg1, $arg2) {
		$query = <<<SQL
		SELECT id
		FROM {$this->tprefix}accounts
		WHERE password = :pass
SQL;
		$resource = $this->db->db->prepare( $query );
			$resource->execute( array (
			":pass"	=> sha1(strtoupper($arg1.':'.$arg2)),
			));
		if($resource->rowCount() == 0 ) {
			echo "WrongLogon";
		}
		else {
			$result = $resource->fetch(PDO::FETCH_ASSOC);
			echo $result['id'];
			self::SetSession($result['id']);
		}
	}
	public function SetSession($arg) {
		session_start();
		$_SESSION['user']['id'] = $arg;
	}
	public function Register($arg,$arg2,$arg3) {
	}
	
	/*For Use As FTP Plugin Later On.
	public function CreateUserFolder($arg,$arg2,$arg3) {
		if(file_exists(ROOT_PATH.'/accounts/'.$arg)) {
			echo "User Exists";

		}
		else {
		mkdir(ROOT_PATH.'/accounts/'.$arg, 0777, true);
		self::CreateFTPAccount($arg,$arg2,$arg3);
		}
	}
	public function CreateFTPAccount($arg,$arg2,$arg3) {
		try {
		$query = <<<SQL
		INSERT INTO {$this->tprefix}ftpuser(userid,passwd,homedir)
		VALUES(:userid,:passwd,:homedir)
SQL;
		$resource = $this->db->db->prepare( $query );
		$resource->execute( array (
		":userid"	=> $arg,
		":passwd"	=> crypt($arg2, "salt"),
		":homedir"	=> "/var/www/html/accounts/".$arg,
		));
		echo "Inserted";
		}
		catch(Exception $e) {
			echo $e->getMessage();
		}
		
	}
	*/
}